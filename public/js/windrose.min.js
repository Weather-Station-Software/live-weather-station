function Windrose(){var O=[];var o={margins:{top:40,right:80,bottom:40,left:40},width:window.innerWidth,widthMax:window.innerWidth,height:window.innerHeight,heightMax:window.innerHeight,innerRadius:20,resize:false,scale:"linear",classed:"lws",color:null,valFormat:"%"};var g;var H;var F;var l;var r;var u;var P=[];var i=o.width-o.margins.left-o.margins.right;var L=o.height-o.margins.top-o.margins.bottom;var s=(Math.min(i,L)/2);var j=d4.scaleLinear().range([0,2*Math.PI]);var D=d4.scaleLinear().range([o.innerRadius,s]);var B=d4.scaleBand().range([0,2*Math.PI]).align(0);var w=d4.scaleLinear().range([o.innerRadius,s]);var v=d3.scaleOrdinal().range(["#4242f4","#42c5f4","#42f4ce","#42f456","#adf442","#f4e242","#f4a142","#f44242"]);var e;var b=d4.format(o.valFormat);var N=0;var c=[];var J={};var t=0;var p;var n;var E;if(o.scale!="linear"){w=d4.scaleRadial().range([o.innerRadius,s])}function Q(x){x.each(function(){e=d4.select(this);A();var y=e.append("svg").attr("overflow","visible").attr("width",o.width).attr("height",o.height);g=y.append("g").attr("class",o.classed+"WindroseNode");H=y.append("g").attr("class",o.classed+"HoverNode");F=y.append("g").attr("class",o.classed+"TooltipNode");l=y.append("g").attr("class",o.classed+"Legend");u=F.append("foreignObject").attr("class",o.classed+"Tooltip").style("opacity",0).style("padding-top","10px").style("padding-left","20px").style("width","200").style("height","200");r=function(){var z=N;b=d4.format(o.valFormat)}})}function f(x){return x.length?x[0].values.map(function(z,y){return z.axis}):[]}function I(W,z,V){if(z.constructor===Array){z.forEach(function(Y){y(Y)})}else{if(typeof z!="object"){y(z)}else{return Q}}function y(Y){if(!isNaN(Y)&&(function(Z){return(Z|0)===Z})(parseFloat(Y))){U(parseInt(Y))}else{if(typeof Y=="string"){U(Y)}}}function U(Y){if(V.indexOf(Y)>=0){X(Y)}else{if(Y>=0&&Y<V.length){X(V[Y])}}}function X(Y){if(W.indexOf(Y)>=0){x(W,Y)}else{W.push(Y)}}function x(Y,aa){for(var Z=Y.length;Z--;){if(Y[Z]===aa){Y.splice(Z,1)}}}}function S(y,z,x){return J.rScale(y?y:J.maxValue*z)*Math.cos(J.angleSlice*x-Math.PI/2)}function R(y,z,x){return J.rScale(y?y:J.maxValue*z)*Math.sin(J.angleSlice*x-Math.PI/2)}function m(z,x,y){x=x?x:z._i;y=y?y:z.key;return o.areas.colors[y]?o.areas.colors[y]:o.color[x]}Q.nodes=function(){return{svg:svg,chart:g,hover:H,tooltip:F,legend:l}};Q.events=function(z){if(!arguments.length){return events}var U=Object.keys(z);var y=Object.keys(events);for(var x=0;x<U.length;x++){if(y.indexOf(U[x])>=0){events[U[x]]=z[U[x]]}}return Q};Q.width=function(x){if(!arguments.length){return o.width}if(o.resize){o.widthMax=x}else{o.width=x}A();return Q};Q.height=function(x){if(!arguments.length){return o.height}if(o.resize){o.heightMax=x}else{o.height=x}A();return Q};Q.duration=function(x){if(!arguments.length){return N}N=x;return Q};Q.update=function(){if(events.update.begin){events.update.begin(P)}if(typeof r==="function"){r()}setTimeout(function(){if(events.update.end){events.update.end(P)}},N)};Q.data=function(y){if(!arguments.length){return O}if(c.length){var x=P.map(function(z){return z.key});c.forEach(function(U,z){Q.filterAreas(x[z])})}c=[];O=y;return Q};Q.pop=function(){var x=O.pop();if(typeof r==="function"){r()}return x};Q.push=function(z){if(z&&z.constructor===Array){for(var y=0;y<z.length;y++){x(z[y])}}else{x(z)}function x(U){if(U.key&&O.map(function(V){return V.key}).indexOf(U.key)<0){O.push(U)}}return Q};Q.shift=function(){var x=O.shift();if(typeof r==="function"){r()}return x};Q.unshift=function(z){if(z&&z.constructor===Array){for(var y=0;y<z.length;y++){x(z[y])}}else{x(z)}function x(U){if(U.key&&O.map(function(V){return V.key}).indexOf(U.key)<0){O.unshift(U)}}return Q};Q.slice=function(y,x){return O.slice(y,x)};Q.options=function(V){if(!arguments.length){return o}var W=Object.keys(V);var X=Object.keys(o);for(var U=0;U<W.length;U++){if(X.indexOf(W[U])>=0){if(typeof(o[W[U]])=="object"){var x=Object.keys(V[W[U]]);var z=Object.keys(o[W[U]]);for(var y=0;y<x.length;y++){if(z.indexOf(x[y])>=0){o[W[U]][x[y]]=V[W[U]][x[y]]}}}else{o[W[U]]=V[W[U]]}}}return Q};Q.margins=function(z){if(!arguments.length){return o.margins}var y=Object.keys(values);var U=Object.keys(o.margins);for(var x=0;x<y.length;x++){if(U.indexOf(y[x])>=0){o.margins[y[x]]=values[y[x]]}}return Q};Q.levels=function(x){if(!arguments.length){return o.circles.levels}o.circles.levels=x;return Q};Q.maxValue=function(x){if(!arguments.length){return o.circles.maxValue}o.circles.maxValue=x;return Q};Q.opacity=function(x){if(!arguments.length){return o.areas.opacity}o.areas.opacity=x;return Q};Q.borderWidth=function(x){if(!arguments.length){return o.areas.borderWidth}o.areas.borderWidth=x;return Q};Q.rounded=function(x){if(!arguments.length){return o.areas.rounded}o.areas.rounded=x;return Q};Q.color=function(x){if(!arguments.length){return o.color}o.color=x;return Q};Q.colors=function(x){if(!arguments.length){return o.areas.colors}o.areas.colors=x;return Q};Q.keys=function(){return O.map(function(x){return x.key})};Q.axes=function(){return f(O)};Q.filterAxes=function(x){if(!arguments.length){return o.axes.filter}var y=f(O);I(o.axes.filter,x,y);return Q};Q.filterAreas=function(x){if(!arguments.length){return o.areas.filter}var y=O.map(function(z){return z.key});I(o.areas.filter,x,y);return Q};Q.invert=function(x){if(!arguments.length){return o.axes.invert}var y=f(O);I(o.axes.invert,x,y);return Q};Q.ranges=function(y){if(!arguments.length){return o.axes.ranges}if(typeof y=="string"){return Q}var U=f(O);if(y&&y.constructor===Array){y.forEach(function(V){x(V)})}else{x(y)}function x(X){var W=Object.keys(X);for(var V=0;V<W.length;V++){if(U.indexOf(W[V])>=0&&X[W[V]]&&X[W[V]].constructor===Array&&z(W[V],X[W[V]])){o.axes.ranges[W[V]]=X[W[V]]}}}function z(W,V){if(V.length==2&&!isNaN(V[0])&&!isNaN(V[1])){return true}else{if(V.length==0){delete o.axes.ranges[W]}}return false}return Q};function M(z,y,x){if(c[z._i]){return}g.selectAll("."+o.classed+"RadarArea").transition().duration(200).style("fill-opacity",function(W,V,U){return o.areas.filter.indexOf(W.key)>=0?0:0.1});d4.select(x).transition().duration(200).style("fill-opacity",function(W,V,U){return o.areas.filter.indexOf(W.key)>=0?0:0.7});K(z,y,x)}function C(z,y,x){g.selectAll("."+o.classed+"RadarArea").transition().duration(200).style("fill-opacity",function(W,V,U){return o.areas.filter.indexOf(W.key)>=0?0:o.areas.opacity});a(z,y,x)}function k(U,y,x){if(c[U]){return}var z=p.indexOf(U)>=0?U:n(U);g.selectAll("."+o.classed+"RadarArea").transition().duration(200).style("fill-opacity",function(X,W,V){return o.areas.filter.indexOf(X.key)>=0?0:0.1});g.selectAll("."+o.classed+"RadarArea."+z.replace(/\s+/g,"")).transition().duration(200).style("fill-opacity",function(X,W,V){return o.areas.filter.indexOf(X.key)>=0?0:0.7})}function h(U,y,x){var z=P.map(function(V){return V.key});I(o.areas.filter,z[U],z);c[U]=c[U]?false:true;r()}function K(U,y,x){if(c[U._i]){return}if(o.width>200){var V=f(P);g.select('[key="'+U.axis+'"]').select("foreignObject").style("opacity",1);newX=-((o.width-250)/10)-40-(o.width/2);newY=((o.height-250)/20)-(o.height/10)-(o.height/2);var z=U.key.replace(/ - /gi,"<br/>");u.attr("x",newX).attr("y",newY).html('<span style="float:left;text-align:left;">'+z+"</span>").transition().duration(200).style("opacity",1)}}function a(z,y,x){g.select('[key="'+z.axis+'"]').select("foreignObject").style("opacity",o.axes.display&&J.radius>o.axes.threshold?1:0);u.transition().duration(200).style("opacity",0)}function d(z,U,y){for(var x=0;x<y.length;x++){y[x]["_i"]=z;y[x]["key"]=U}return y}var T=function(x){return x&&x.key};var q=function(x){return x&&x.axis};function G(y,x){y.each(function(X,W,V){var ad=d4.select(this);var Y=X.axis.split(/\s+/).reverse();var z;var af=[];var U=0;var ac=1.4;var ab=S(null,o.circles.labelFactor,V);var aa=R(null,o.circles.labelFactor,V);var ae=parseFloat(ad.attr("dy"));var Z=ad.text(null).append("tspan").attr("dy",ae+"em");while(z=Y.pop()){af.push(z);Z.text(af.join(" "));if(Z.node().getComputedTextLength()>x){af.pop();Z.text(af.join(" "));af=[z];Z=ad.append("tspan").attr("dy",++U*ac+ae+"em").text(z)}}})}window.addEventListener("resize",A,false);function A(){if(!o.resize||!e){return}var y=e.node().getBoundingClientRect().left;var U=e.node().getBoundingClientRect().top;var z=Math.min(o.widthMax,document.documentElement.clientWidth-y);var x=Math.min(o.heightMax,document.documentElement.clientHeight-U);o.height=x;o.width=z;Q.update()}return Q};