function Windrose(){var J=[];var f={size:600,legend:false,fixed:false,scale:"linear",classed:"lws",color:false};var e;var A;var g;var H;var j;var c={update:{begin:null,end:null},gridCircle:{mouseover:null,mouseout:null,mouseclick:null},axisLabel:{mouseover:null,mouseout:null,mouseclick:null},line:{mouseover:null,mouseout:null,mouseclick:null},legend:{mouseover:null,mouseout:null,mouseclick:null},axisLegend:{mouseover:null,mouseout:null,mouseclick:null},pieArea:{mouseover:null,mouseout:null,mouseclick:null},radarInvisibleCircle:{mouseover:null,mouseout:null,mouseclick:null}};var l;var i;var w=[];var G=["#4242f4","#42c5f4","#42f4ce","#42f456","#adf442","#f4e242","#f4a142","#f44242"];var s=[];var d=[];var F=f.legend;var C=f.size-40;var k=f.size/30;var B=(C/2);var D=5;var E=d4.scaleLinear().range([0,2*Math.PI]);var h=d4.scaleLinear().range([k,B]);var r=d4.scaleBand().range([0,2*Math.PI]).align(0);var p=d4.scaleLinear().range([k,B]);var n=d4.scaleOrdinal().range(G);var t;var b=0;var u=[];if(f.scale!="linear"){p=d4.scaleRadial().range([k,B])}function v(x){x.each(function(){t=d4.select(this);s=J.series;d=J.legend;var y=t.append("svg").attr("overflow","visible").attr("width",f.size).attr("height",f.size).attr("transform","translate("+f.size/2+","+f.size/2+")");e=y.append("g").attr("class",f.classed+"WindroseNode");j=y.append("g").attr("class",f.classed+"AxisWrapper");H=y.append("g").attr("class",f.classed+"Legend");A=y.append("g").attr("class",f.classed+"HoverNode");g=y.append("g").attr("class",f.classed+"TooltipNode");i=g.append("foreignObject").attr("class",f.classed+"Tooltip").style("opacity",0).style("padding-top","10px").style("padding-left","20px").style("width","200").style("height","200");l=function(){s=J.series;d=J.legend;F=f.legend;C=f.size-40;k=f.size/30;D=5;if(f.size<300){D=3}B=(C/2);E=d4.scaleLinear().range([0,2*Math.PI]);h=d4.scaleLinear().range([k,B]);r=d4.scaleBand().range([0,2*Math.PI]).align(0);p=d4.scaleLinear().range([k,B]);if(f.scale!="linear"){p=d4.scaleRadial().range([k,B])}if(f.color){n=d4.scaleOrdinal().range(f.color)}else{n=d4.scaleOrdinal().range(G.slice(0,s[0].values.length))}r.domain(s.map(function(Z){return Z.axis}));n.domain(d);if(f.fixed){p.domain([0,0.5])}else{max=0;s.forEach(function(Z){m=0;Z.values.forEach(function(aa){m+=aa});if(m>max){max=m}});p.domain([0,max])}E.domain([0,d4.max(s,function(aa,Z){return Z+1})]);h.domain([0,d4.max(s,function(Z){return Z.y0+Z.y})]);angleOffset=-360/s.length/2;y.attr("width",f.size).attr("height",f.size).attr("transform","translate("+f.size/2+","+f.size/2+")");j.selectAll(".axis").data(d4.range(E.domain()[1])).enter().append("g").attr("class",f.classed+"Axis").attr("transform",function(Z){return"rotate("+E(Z)*180/Math.PI+")"}).call(d4.axisLeft().tickSize(f.size/75).scale(h.copy().range([-k,-(B+8)])));var z=j.append("g").attr("text-anchor","middle");var M=z.selectAll("g").data(p.ticks(D).slice(1)).enter().append("g");M.append("circle").attr("fill","none").attr("stroke-dasharray","4,4").attr("r",p);var X=H.append("g").selectAll("g").data(s).enter().append("g").attr("text-anchor","middle").attr("transform",function(Z){return"rotate("+((r(Z.axis)+r.bandwidth()/2)*180/Math.PI-(90-angleOffset))+")translate("+(B+30)+",0)"});X.append("text").attr("transform",function(Z){return(r(Z.axis)+r.bandwidth()/2+Math.PI/2)%(2*Math.PI)<Math.PI?"rotate(90)translate(0,16)":"rotate(-90)translate(0,-9)"}).attr("alignment-baseline","baseline").text(function(Z){return Z.axis});if(F){var W=B/30;var K=W+4;var L=W+2;var T=W*1.7;var R=T/3.4;var Y=H.append("g").selectAll("g").data(d).enter().append("g").attr("transform",function(aa,Z){return"translate("+(-B-30)+","+(B+18-Z*K)+")"});Y.append("rect").attr("width",W).attr("height",W).attr("fill",n);Y.append("text").attr("x",T).attr("y",R).attr("dy","0.35em").text(function(Z){return Z}).style("font-size",L)}var V=e.append("g").attr("class",f.classed+"PieWrapper");for(var U=0;U<s[0].values.length;U++){var Q=V.append("g").attr("class",f.classed+"Pie");for(var N=0;N<s.length;N++){if(U===0){innerY=p(0);outerY=p(s[N].values[0])}else{var S=0;for(var P=0;P<U;P++){S=S+s[N].values[P]}innerY=p(S);S=0;for(var O=0;O<=U;O++){S=S+s[N].values[O]}outerY=p(S)}Q.append("path").attr("fill",n(U)).attr("d",d4.arc().innerRadius(innerY).outerRadius(outerY).startAngle(r(s[N].axis)).endAngle(r(s[N].axis)+r.bandwidth()).padAngle(0.01).padRadius(k)).attr("class",f.classed+"PieArea").attr("transform","rotate("+angleOffset+")")}}}})}v.update=function(){if(c.update.begin){c.update.begin(w)}if(typeof l==="function"){l()}setTimeout(function(){if(c.update.end){c.update.end(w)}},b)};v.data=function(y){if(!arguments.length){return J}if(u.length){var x=w.map(function(z){return z.key});u.forEach(function(K,z){v.filterAreas(x[z])})}u=[];J=y;return v};v.options=function(L){if(!arguments.length){return f}var M=Object.keys(L);var N=Object.keys(f);for(var K=0;K<M.length;K++){if(N.indexOf(M[K])>=0){if(typeof(f[M[K]])=="object"){var x=Object.keys(L[M[K]]);var z=Object.keys(f[M[K]]);for(var y=0;y<x.length;y++){if(z.indexOf(x[y])>=0){f[M[K]][x[y]]=L[M[K]][x[y]]}}}else{f[M[K]]=L[M[K]]}}}return v};function a(z,y,x){if(u[z._i]){return}e.selectAll("."+f.classed+"PieArea").transition().duration(200).style("fill-opacity",function(M,L,K){return f.areas.filter.indexOf(M.key)>=0?0:0.1});d4.select(x).transition().duration(200).style("fill-opacity",function(M,L,K){return f.areas.filter.indexOf(M.key)>=0?0:0.7});o(z,y,x)}function q(z,y,x){e.selectAll("."+f.classed+"PieArea").transition().duration(200).style("fill-opacity",function(M,L,K){return f.areas.filter.indexOf(M.key)>=0?0:f.areas.opacity});I(z,y,x)}function o(K,y,x){if(u[K._i]){return}if(f.width>200){var L=getAxisLabels(w);e.select('[key="'+K.axis+'"]').select("foreignObject").style("opacity",1);newX=-((f.width-250)/10)-40-(f.width/2);newY=((f.height-250)/20)-(f.height/10)-(f.height/2);var z=K.key.replace(/ - /gi,"<br/>");i.attr("x",newX).attr("y",newY).html('<span style="float:left;text-align:left;">'+z+"</span>").transition().duration(200).style("opacity",1)}}function I(z,y,x){e.select('[key="'+z.axis+'"]').select("foreignObject").style("opacity",f.axes.display&&radial_calcs.radius>f.axes.threshold?1:0);i.transition().duration(200).style("opacity",0)}return v};