function Windrose(){var M=[];var m={size:600,scale:"linear",classed:"lws",color:false};var f;var H;var F;var k;var h;var n={update:{begin:null,end:null},gridCircle:{mouseover:null,mouseout:null,mouseclick:null},axisLabel:{mouseover:null,mouseout:null,mouseclick:null},line:{mouseover:null,mouseout:null,mouseclick:null},legend:{mouseover:null,mouseout:null,mouseclick:null},axisLegend:{mouseover:null,mouseout:null,mouseclick:null},radarArea:{mouseover:null,mouseout:null,mouseclick:null},radarInvisibleCircle:{mouseover:null,mouseout:null,mouseclick:null}};var q;var t;var N=[];var u=m.size-40;var a=m.size/30;var r=(u/2);var i=d4.scaleLinear().range([0,2*Math.PI]);var D=d4.scaleLinear().range([a,r]);var B=d4.scaleBand().range([0,2*Math.PI]).align(0);var w=d4.scaleLinear().range([a,r]);var v=d4.scaleOrdinal().range(["#4242f4","#42c5f4","#42f4ce","#42f456","#adf442","#f4e242","#f4a142","#f44242"]);var d;var L=0;var c=[];var I={};var s=0;var o;var l;var E;if(m.scale!="linear"){w=d4.scaleRadial().range([a,r])}function O(x){x.each(function(){d=d4.select(this);var y=d.append("svg").attr("overflow","visible").attr("width",m.size).attr("height",m.size).attr("transform","translate("+m.size/2+","+m.size/2+")");f=y.append("g").attr("class",m.classed+"WindroseNode");H=y.append("g").attr("class",m.classed+"HoverNode");F=y.append("g").attr("class",m.classed+"TooltipNode");k=y.append("g").attr("class",m.classed+"Legend");h=f.append("g").attr("class",m.classed+"AxisWrapper");t=F.append("foreignObject").attr("class",m.classed+"Tooltip").style("opacity",0).style("padding-top","10px").style("padding-left","20px").style("width","200").style("height","200");q=function(){u=m.size-40;a=m.size/30;r=(u/2);i=d4.scaleLinear().range([0,2*Math.PI]);D=d4.scaleLinear().range([a,r]);B=d4.scaleBand().range([0,2*Math.PI]).align(0);w=d4.scaleLinear().range([a,r]);v=d4.scaleOrdinal().range(["#4242f4","#42c5f4","#42f4ce","#42f456","#adf442","#f4e242","#f4a142","#f44242"]);B.domain(M.map(function(S){return S.axis}));w.domain([0,1]);v.domain(M);i.domain([0,d4.max(M,function(T,S){return S+1})]);D.domain([0,d4.max(M,function(S){return S.y0+S.y})]);angleOffset=-360/M.length/2;y.attr("width",m.size).attr("height",m.size).attr("transform","translate("+m.size/2+","+m.size/2+")");h.selectAll(".axis").data(d4.range(i.domain()[1])).enter().append("g").attr("class",m.classed+"Axis").attr("transform",function(S){return"rotate("+i(S)*180/Math.PI+")"}).call(d4.axisLeft().tickSize(m.size/75).scale(D.copy().range([-a,-(r+8)])));var Q=h.append("g").attr("text-anchor","middle");var z=Q.selectAll("g").data(w.ticks(5)).enter().append("g");z.append("circle").attr("fill","none").attr("stroke-dasharray","4,4").attr("r",w);var R=k.append("g").selectAll("g").data(M).enter().append("g").attr("text-anchor","middle").attr("transform",function(S){return"rotate("+((B(S.axis)+B.bandwidth()/2)*180/Math.PI-(90-angleOffset))+")translate("+(r+30)+",0)"});R.append("text").attr("transform",function(S){return(B(S.axis)+B.bandwidth()/2+Math.PI/2)%(2*Math.PI)<Math.PI?"rotate(90)translate(0,16)":"rotate(-90)translate(0,-9)"}).attr("alignment-baseline","baseline").text(function(S){return S.axis});f.append("g").selectAll("g").data(M).enter().append("g").attr("fill",function(S){console.log(S);return v(S.values[0])}).selectAll("path").data(function(S){return S.values}).enter().append("path").attr("d",d4.arc().innerRadius(function(S){return w(S[0])}).outerRadius(function(S){return w(S[1])}).startAngle(function(S){return B(S.data[0])}).endAngle(function(S){return B(S.data[0])+B.bandwidth()}).padAngle(0.01).padRadius(a)).attr("transform",function(){return"rotate("+angleOffset+")"})}})}O.nodes=function(){return{svg:svg,chart:f,hover:H,tooltip:F,legend:k}};O.events=function(z){if(!arguments.length){return n}var Q=Object.keys(z);var y=Object.keys(n);for(var x=0;x<Q.length;x++){if(y.indexOf(Q[x])>=0){n[Q[x]]=z[Q[x]]}}return O};O.width=function(x){if(!arguments.length){return m.width}if(m.resize){m.widthMax=x}else{m.width=x}A();return O};O.height=function(x){if(!arguments.length){return m.height}if(m.resize){m.heightMax=x}else{m.height=x}A();return O};O.duration=function(x){if(!arguments.length){return L}L=x;return O};O.update=function(){if(n.update.begin){n.update.begin(N)}if(typeof q==="function"){q()}setTimeout(function(){if(n.update.end){n.update.end(N)}},L)};O.data=function(y){if(!arguments.length){return M}if(c.length){var x=N.map(function(z){return z.key});c.forEach(function(Q,z){O.filterAreas(x[z])})}c=[];M=y;return O};O.pop=function(){var x=M.pop();if(typeof q==="function"){q()}return x};O.push=function(z){if(z&&z.constructor===Array){for(var y=0;y<z.length;y++){x(z[y])}}else{x(z)}function x(Q){if(Q.key&&M.map(function(R){return R.key}).indexOf(Q.key)<0){M.push(Q)}}return O};O.shift=function(){var x=M.shift();if(typeof q==="function"){q()}return x};O.unshift=function(z){if(z&&z.constructor===Array){for(var y=0;y<z.length;y++){x(z[y])}}else{x(z)}function x(Q){if(Q.key&&M.map(function(R){return R.key}).indexOf(Q.key)<0){M.unshift(Q)}}return O};O.slice=function(y,x){return M.slice(y,x)};O.options=function(R){if(!arguments.length){return m}var S=Object.keys(R);var T=Object.keys(m);for(var Q=0;Q<S.length;Q++){if(T.indexOf(S[Q])>=0){if(typeof(m[S[Q]])=="object"){var x=Object.keys(R[S[Q]]);var z=Object.keys(m[S[Q]]);for(var y=0;y<x.length;y++){if(z.indexOf(x[y])>=0){m[S[Q]][x[y]]=R[S[Q]][x[y]]}}}else{m[S[Q]]=R[S[Q]]}}}return O};O.margins=function(z){if(!arguments.length){return m.margins}var y=Object.keys(values);var Q=Object.keys(m.margins);for(var x=0;x<y.length;x++){if(Q.indexOf(y[x])>=0){m.margins[y[x]]=values[y[x]]}}return O};O.levels=function(x){if(!arguments.length){return m.circles.levels}m.circles.levels=x;return O};O.maxValue=function(x){if(!arguments.length){return m.circles.maxValue}m.circles.maxValue=x;return O};O.opacity=function(x){if(!arguments.length){return m.areas.opacity}m.areas.opacity=x;return O};O.borderWidth=function(x){if(!arguments.length){return m.areas.borderWidth}m.areas.borderWidth=x;return O};O.rounded=function(x){if(!arguments.length){return m.areas.rounded}m.areas.rounded=x;return O};O.color=function(x){if(!arguments.length){return m.color}m.color=x;return O};O.colors=function(x){if(!arguments.length){return m.areas.colors}m.areas.colors=x;return O};O.keys=function(){return M.map(function(x){return x.key})};O.axes=function(){return getAxisLabels(M)};O.filterAxes=function(x){if(!arguments.length){return m.axes.filter}var y=getAxisLabels(M);modifyList(m.axes.filter,x,y);return O};O.filterAreas=function(x){if(!arguments.length){return m.areas.filter}var y=M.map(function(z){return z.key});modifyList(m.areas.filter,x,y);return O};O.invert=function(x){if(!arguments.length){return m.axes.invert}var y=getAxisLabels(M);modifyList(m.axes.invert,x,y);return O};O.ranges=function(y){if(!arguments.length){return m.axes.ranges}if(typeof y=="string"){return O}var Q=getAxisLabels(M);if(y&&y.constructor===Array){y.forEach(function(R){x(R)})}else{x(y)}function x(T){var S=Object.keys(T);for(var R=0;R<S.length;R++){if(Q.indexOf(S[R])>=0&&T[S[R]]&&T[S[R]].constructor===Array&&z(S[R],T[S[R]])){m.axes.ranges[S[R]]=T[S[R]]}}}function z(S,R){if(R.length==2&&!isNaN(R[0])&&!isNaN(R[1])){return true}else{if(R.length==0){delete m.axes.ranges[S]}}return false}return O};function K(z,y,x){if(c[z._i]){return}f.selectAll("."+m.classed+"RadarArea").transition().duration(200).style("fill-opacity",function(S,R,Q){return m.areas.filter.indexOf(S.key)>=0?0:0.1});d4.select(x).transition().duration(200).style("fill-opacity",function(S,R,Q){return m.areas.filter.indexOf(S.key)>=0?0:0.7});J(z,y,x)}function C(z,y,x){f.selectAll("."+m.classed+"RadarArea").transition().duration(200).style("fill-opacity",function(S,R,Q){return m.areas.filter.indexOf(S.key)>=0?0:m.areas.opacity});b(z,y,x)}function j(Q,y,x){if(c[Q]){return}var z=o.indexOf(Q)>=0?Q:l(Q);f.selectAll("."+m.classed+"RadarArea").transition().duration(200).style("fill-opacity",function(T,S,R){return m.areas.filter.indexOf(T.key)>=0?0:0.1});f.selectAll("."+m.classed+"RadarArea."+z.replace(/\s+/g,"")).transition().duration(200).style("fill-opacity",function(T,S,R){return m.areas.filter.indexOf(T.key)>=0?0:0.7})}function g(Q,y,x){var z=N.map(function(R){return R.key});modifyList(m.areas.filter,z[Q],z);c[Q]=c[Q]?false:true;q()}function J(Q,y,x){if(c[Q._i]){return}if(m.width>200){var R=getAxisLabels(N);f.select('[key="'+Q.axis+'"]').select("foreignObject").style("opacity",1);newX=-((m.width-250)/10)-40-(m.width/2);newY=((m.height-250)/20)-(m.height/10)-(m.height/2);var z=Q.key.replace(/ - /gi,"<br/>");t.attr("x",newX).attr("y",newY).html('<span style="float:left;text-align:left;">'+z+"</span>").transition().duration(200).style("opacity",1)}}function b(z,y,x){f.select('[key="'+z.axis+'"]').select("foreignObject").style("opacity",m.axes.display&&I.radius>m.axes.threshold?1:0);t.transition().duration(200).style("opacity",0)}function e(z,Q,y){for(var x=0;x<y.length;x++){y[x]["_i"]=z;y[x]["key"]=Q}return y}var P=function(x){return x&&x.key};var p=function(x){return x&&x.axis};function G(y,x){y.each(function(T,S,R){var Z=d4.select(this);var U=T.axis.split(/\s+/).reverse();var z;var ab=[];var Q=0;var Y=1.4;var X=calcX(null,m.circles.labelFactor,R);var W=calcY(null,m.circles.labelFactor,R);var aa=parseFloat(Z.attr("dy"));var V=Z.text(null).append("tspan").attr("dy",aa+"em");while(z=U.pop()){ab.push(z);V.text(ab.join(" "));if(V.node().getComputedTextLength()>x){ab.pop();V.text(ab.join(" "));ab=[z];V=Z.append("tspan").attr("dy",++Q*Y+aa+"em").text(z)}}})}window.addEventListener("resize",A,false);function A(){if(!m.resize||!d){return}var y=d.node().getBoundingClientRect().left;var Q=d.node().getBoundingClientRect().top;var z=Math.min(m.widthMax,document.documentElement.clientWidth-y);var x=Math.min(m.heightMax,document.documentElement.clientHeight-Q);m.height=x;m.width=z;O.update()}return O};