function Windrose(){var J=[];var f={size:0,legend:false,fixed:false,scale:"linear",classed:"lws",color:false};var e;var A;var g;var H;var j;var c={update:{begin:null,end:null},gridCircle:{mouseover:null,mouseout:null,mouseclick:null},axisLabel:{mouseover:null,mouseout:null,mouseclick:null},line:{mouseover:null,mouseout:null,mouseclick:null},legend:{mouseover:null,mouseout:null,mouseclick:null},axisLegend:{mouseover:null,mouseout:null,mouseclick:null},pieArea:{mouseover:null,mouseout:null,mouseclick:null},radarInvisibleCircle:{mouseover:null,mouseout:null,mouseclick:null}};var l;var i;var w=[];var G=["#4242f4","#42c5f4","#42f4ce","#42f456","#adf442","#f4e242","#f4a142","#f44242"];var s=[];var d=[];var F=f.legend;var C=f.size-40;var k=f.size/30;var B=(C/2);var D=5;var E=d4.scaleLinear().range([0,2*Math.PI]);var h=d4.scaleLinear().range([k,B]);var r=d4.scaleBand().range([0,2*Math.PI]).align(0);var p=d4.scaleLinear().range([k,B]);var n=d4.scaleOrdinal().range(G);var t;var b=0;var u=[];if(f.scale!="linear"){p=d4.scaleRadial().range([k,B])}function v(x){x.each(function(){t=d4.select(this);l=function(){s=J.series;d=J.legend;F=f.legend;C=f.size-40;k=f.size/30;D=5;if(f.size<300){D=3}B=(C/2);E=d4.scaleLinear().range([0,2*Math.PI]);h=d4.scaleLinear().range([k,B]);r=d4.scaleBand().range([0,2*Math.PI]).align(0);p=d4.scaleLinear().range([k,B]);if(f.scale!="linear"){p=d4.scaleRadial().range([k,B])}if(f.color){n=d4.scaleOrdinal().range(f.color)}else{n=d4.scaleOrdinal().range(G.slice(0,s[0].values.length))}r.domain(s.map(function(aa){return aa.axis}));n.domain(d);if(f.fixed){p.domain([0,0.5])}else{max=0;s.forEach(function(aa){m=0;aa.values.forEach(function(ab){m+=ab});if(m>max){max=m}});p.domain([0,max])}E.domain([0,d4.max(s,function(ab,aa){return aa+1})]);h.domain([0,d4.max(s,function(aa){return aa.y0+aa.y})]);angleOffset=-360/s.length/2;var X=t.append("svg").attr("overflow","visible").attr("width",f.size).attr("height",f.size);var S=X.append("g").attr("overflow","visible").attr("width",f.size).attr("height",f.size).attr("transform","translate("+f.size/2+","+f.size/2+")");e=S.append("g").attr("class",f.classed+"WindroseNode");j=S.append("g").attr("class",f.classed+"AxisWrapper");H=S.append("g").attr("class",f.classed+"Legend");A=S.append("g").attr("class",f.classed+"HoverNode");g=S.append("g").attr("class",f.classed+"TooltipNode");i=g.append("foreignObject").attr("class",f.classed+"Tooltip").style("opacity",0).style("padding-top","10px").style("padding-left","20px").style("width","200").style("height","200");j.selectAll(".axis").data(d4.range(E.domain()[1])).enter().append("g").attr("class",f.classed+"Axis").attr("transform",function(aa){return"rotate("+E(aa)*180/Math.PI+")"}).call(d4.axisLeft().tickSize(f.size/75).scale(h.copy().range([-k,-(B+8)])));var y=j.append("g").attr("text-anchor","middle");var T=y.selectAll("g").data(p.ticks(D).slice(1)).enter().append("g");T.append("circle").attr("fill","none").attr("stroke-dasharray","4,4").attr("r",p);var N=H.append("g").selectAll("g").data(s).enter().append("g").attr("text-anchor","middle").attr("transform",function(aa){return"rotate("+((r(aa.axis)+r.bandwidth()/2)*180/Math.PI-(90-angleOffset))+")translate("+(B+30)+",0)"});N.append("text").attr("transform",function(aa){return(r(aa.axis)+r.bandwidth()/2+Math.PI/2)%(2*Math.PI)<Math.PI?"rotate(90)translate(0,16)":"rotate(-90)translate(0,-9)"}).text(function(aa){return aa.axis});if(F){var z=B/30;var Y=z+4;var R=z+2;var L=z*1.7;var K=L/3.4;var P=H.append("g").selectAll("g").data(d).enter().append("g").attr("transform",function(ab,aa){return"translate("+(-B-30)+","+(B+18-aa*Y)+")"});P.append("rect").attr("width",z).attr("height",z).attr("fill",n);P.append("text").attr("x",L).attr("y",K).attr("dy","0.35em").text(function(aa){return aa}).style("font-size",R)}var U=e.append("g").attr("class",f.classed+"PieWrapper");for(var M=0;M<s[0].values.length;M++){var Q=U.append("g").attr("class",f.classed+"Pie");for(var Z=0;Z<s.length;Z++){if(M===0){innerY=p(0);outerY=p(s[Z].values[0])}else{var O=0;for(var W=0;W<M;W++){O=O+s[Z].values[W]}innerY=p(O);O=0;for(var V=0;V<=M;V++){O=O+s[Z].values[V]}outerY=p(O)}Q.append("path").attr("fill",n(M)).attr("d",d4.arc().innerRadius(innerY).outerRadius(outerY).startAngle(r(s[Z].axis)).endAngle(r(s[Z].axis)+r.bandwidth()).padAngle(0.01).padRadius(k)).attr("class",f.classed+"PieArea").attr("transform","rotate("+angleOffset+")")}}}})}v.update=function(){if(c.update.begin){c.update.begin(w)}if(typeof l==="function"){l()}setTimeout(function(){if(c.update.end){c.update.end(w)}},b)};v.data=function(y){if(!arguments.length){return J}if(u.length){var x=w.map(function(z){return z.key});u.forEach(function(K,z){v.filterAreas(x[z])})}u=[];J=y;return v};v.options=function(L){if(!arguments.length){return f}var M=Object.keys(L);var N=Object.keys(f);for(var K=0;K<M.length;K++){if(N.indexOf(M[K])>=0){if(typeof(f[M[K]])=="object"){var x=Object.keys(L[M[K]]);var z=Object.keys(f[M[K]]);for(var y=0;y<x.length;y++){if(z.indexOf(x[y])>=0){f[M[K]][x[y]]=L[M[K]][x[y]]}}}else{f[M[K]]=L[M[K]]}}}return v};function a(z,y,x){if(u[z._i]){return}e.selectAll("."+f.classed+"PieArea").transition().duration(200).style("fill-opacity",function(M,L,K){return f.areas.filter.indexOf(M.key)>=0?0:0.1});d4.select(x).transition().duration(200).style("fill-opacity",function(M,L,K){return f.areas.filter.indexOf(M.key)>=0?0:0.7});o(z,y,x)}function q(z,y,x){e.selectAll("."+f.classed+"PieArea").transition().duration(200).style("fill-opacity",function(M,L,K){return f.areas.filter.indexOf(M.key)>=0?0:f.areas.opacity});I(z,y,x)}function o(K,y,x){if(u[K._i]){return}if(f.width>200){var L=getAxisLabels(w);e.select('[key="'+K.axis+'"]').select("foreignObject").style("opacity",1);newX=-((f.width-250)/10)-40-(f.width/2);newY=((f.height-250)/20)-(f.height/10)-(f.height/2);var z=K.key.replace(/ - /gi,"<br/>");i.attr("x",newX).attr("y",newY).html('<span style="float:left;text-align:left;">'+z+"</span>").transition().duration(200).style("opacity",1)}}function I(z,y,x){e.select('[key="'+z.axis+'"]').select("foreignObject").style("opacity",f.axes.display&&radial_calcs.radius>f.axes.threshold?1:0);i.transition().duration(200).style("opacity",0)}return v};