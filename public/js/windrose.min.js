function Windrose(){var N=[];var o={size:600,legend:false,fixed:false,scale:"linear",classed:"lws",color:false};var f;var I;var G;var l;var h;var p={update:{begin:null,end:null},gridCircle:{mouseover:null,mouseout:null,mouseclick:null},axisLabel:{mouseover:null,mouseout:null,mouseclick:null},line:{mouseover:null,mouseout:null,mouseclick:null},legend:{mouseover:null,mouseout:null,mouseclick:null},axisLegend:{mouseover:null,mouseout:null,mouseclick:null},radarArea:{mouseover:null,mouseout:null,mouseclick:null},radarInvisibleCircle:{mouseover:null,mouseout:null,mouseclick:null}};var r;var u;var O=[];var H=["#4242f4","#42c5f4","#42f4ce","#42f456","#adf442","#f4e242","#f4a142","#f44242"];var e=[];var C=[];var j=o.legend;var v=o.size-40;var a=o.size/30;var s=(v/2);var i=d4.scaleLinear().range([0,2*Math.PI]);var E=d4.scaleLinear().range([a,s]);var B=d4.scaleBand().range([0,2*Math.PI]).align(0);var A=d4.scaleLinear().range([a,s]);var w=d4.scaleOrdinal().range(H);var d;var M=0;var c=[];var J={};var t=0;var q;var n;var F;if(o.scale!="linear"){A=d4.scaleRadial().range([a,s])}function P(x){x.each(function(){d=d4.select(this);e=N.series;C=N.legend;var y=d.append("svg").attr("overflow","visible").attr("width",o.size).attr("height",o.size).attr("transform","translate("+o.size/2+","+o.size/2+")");f=y.append("g").attr("class",o.classed+"WindroseNode");h=y.append("g").attr("class",o.classed+"AxisWrapper");l=y.append("g").attr("class",o.classed+"Legend");I=y.append("g").attr("class",o.classed+"HoverNode");G=y.append("g").attr("class",o.classed+"TooltipNode");u=G.append("foreignObject").attr("class",o.classed+"Tooltip").style("opacity",0).style("padding-top","10px").style("padding-left","20px").style("width","200").style("height","200");r=function(){e=N.series;C=N.legend;j=o.legend;v=o.size-40;a=o.size/30;s=(v/2);i=d4.scaleLinear().range([0,2*Math.PI]);E=d4.scaleLinear().range([a,s]);B=d4.scaleBand().range([0,2*Math.PI]).align(0);A=d4.scaleLinear().range([a,s]);if(o.scale!="linear"){A=d4.scaleRadial().range([a,s])}if(o.color){w=d4.scaleOrdinal().range(o.color)}else{w=d4.scaleOrdinal().range(H.slice(0,e[0].values.length))}B.domain(e.map(function(af){return af.axis}));w.domain(C);if(o.fixed){A.domain([0,0.5])}else{max=0;e.forEach(function(af){m=0;af.values.forEach(function(ag){m+=ag});if(m>max){max=m}});A.domain([0,max])}i.domain([0,d4.max(e,function(ag,af){return af+1})]);E.domain([0,d4.max(e,function(af){return af.y0+af.y})]);angleOffset=-360/e.length/2;y.attr("width",o.size).attr("height",o.size).attr("transform","translate("+o.size/2+","+o.size/2+")");h.selectAll(".axis").data(d4.range(i.domain()[1])).enter().append("g").attr("class",o.classed+"Axis").attr("transform",function(af){return"rotate("+i(af)*180/Math.PI+")"}).call(d4.axisLeft().tickSize(o.size/75).scale(E.copy().range([-a,-(s+8)])));var z=h.append("g").attr("text-anchor","middle");var S=z.selectAll("g").data(A.ticks(5)).enter().append("g");S.append("circle").attr("fill","none").attr("stroke-dasharray","4,4").attr("r",A);var ad=l.append("g").selectAll("g").data(e).enter().append("g").attr("text-anchor","middle").attr("transform",function(af){return"rotate("+((B(af.axis)+B.bandwidth()/2)*180/Math.PI-(90-angleOffset))+")translate("+(s+30)+",0)"});ad.append("text").attr("transform",function(af){return(B(af.axis)+B.bandwidth()/2+Math.PI/2)%(2*Math.PI)<Math.PI?"rotate(90)translate(0,16)":"rotate(-90)translate(0,-9)"}).attr("alignment-baseline","baseline").text(function(af){return af.axis});if(j){var ac=s/30;var Q=ac+4;var R=ac+2;var Z=ac*1.7;var X=Z/3.4;var ae=l.append("g").selectAll("g").data(C).enter().append("g").attr("transform",function(ag,af){return"translate("+(-s-30)+","+(s+18-af*Q)+")"});ae.append("rect").attr("width",ac).attr("height",ac).attr("fill",w);ae.append("text").attr("x",Z).attr("y",X).attr("dy","0.35em").text(function(af){return af}).style("font-size",R)}var ab=f.append("g").attr("class",o.classed+"PieWrapper");for(var aa=0;aa<e[0].values.length;aa++){var W=ab.append("g").attr("class",o.classed+"Pie");for(var T=0;T<e.length;T++){if(aa===0){innerY=A(0);outerY=A(e[T].values[0])}else{var Y=0;for(var V=0;V<aa;V++){Y=Y+e[T].values[V]}innerY=A(Y);Y=0;for(var U=0;U<=aa;U++){Y=Y+e[T].values[U]}outerY=A(Y)}W.append("path").attr("fill",w(aa)).attr("d",d4.arc().innerRadius(innerY).outerRadius(outerY).startAngle(B(e[T].axis)).endAngle(B(e[T].axis)+B.bandwidth()).padAngle(0.01).padRadius(a)).attr("transform","rotate("+angleOffset+")")}}}})}P.update=function(){if(p.update.begin){p.update.begin(O)}if(typeof r==="function"){r()}setTimeout(function(){if(p.update.end){p.update.end(O)}},M)};P.data=function(y){if(!arguments.length){return N}if(c.length){var x=O.map(function(z){return z.key});c.forEach(function(Q,z){P.filterAreas(x[z])})}c=[];N=y;return P};P.options=function(R){if(!arguments.length){return o}var S=Object.keys(R);var T=Object.keys(o);for(var Q=0;Q<S.length;Q++){if(T.indexOf(S[Q])>=0){if(typeof(o[S[Q]])=="object"){var x=Object.keys(R[S[Q]]);var z=Object.keys(o[S[Q]]);for(var y=0;y<x.length;y++){if(z.indexOf(x[y])>=0){o[S[Q]][x[y]]=R[S[Q]][x[y]]}}}else{o[S[Q]]=R[S[Q]]}}}return P};function L(z,y,x){if(c[z._i]){return}f.selectAll("."+o.classed+"RadarArea").transition().duration(200).style("fill-opacity",function(S,R,Q){return o.areas.filter.indexOf(S.key)>=0?0:0.1});d4.select(x).transition().duration(200).style("fill-opacity",function(S,R,Q){return o.areas.filter.indexOf(S.key)>=0?0:0.7});K(z,y,x)}function D(z,y,x){f.selectAll("."+o.classed+"RadarArea").transition().duration(200).style("fill-opacity",function(S,R,Q){return o.areas.filter.indexOf(S.key)>=0?0:o.areas.opacity});b(z,y,x)}function k(Q,y,x){if(c[Q]){return}var z=q.indexOf(Q)>=0?Q:n(Q);f.selectAll("."+o.classed+"RadarArea").transition().duration(200).style("fill-opacity",function(T,S,R){return o.areas.filter.indexOf(T.key)>=0?0:0.1});f.selectAll("."+o.classed+"RadarArea."+z.replace(/\s+/g,"")).transition().duration(200).style("fill-opacity",function(T,S,R){return o.areas.filter.indexOf(T.key)>=0?0:0.7})}function g(Q,y,x){var z=O.map(function(R){return R.key});modifyList(o.areas.filter,z[Q],z);c[Q]=c[Q]?false:true;r()}function K(Q,y,x){if(c[Q._i]){return}if(o.width>200){var R=getAxisLabels(O);f.select('[key="'+Q.axis+'"]').select("foreignObject").style("opacity",1);newX=-((o.width-250)/10)-40-(o.width/2);newY=((o.height-250)/20)-(o.height/10)-(o.height/2);var z=Q.key.replace(/ - /gi,"<br/>");u.attr("x",newX).attr("y",newY).html('<span style="float:left;text-align:left;">'+z+"</span>").transition().duration(200).style("opacity",1)}}function b(z,y,x){f.select('[key="'+z.axis+'"]').select("foreignObject").style("opacity",o.axes.display&&J.radius>o.axes.threshold?1:0);u.transition().duration(200).style("opacity",0)}return P};